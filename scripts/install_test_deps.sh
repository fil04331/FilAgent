#!/bin/bash
# Script pour installer les d√©pendances de test pour FilAgent

set -e  # Exit on error

echo "================================================"
echo "Installation des d√©pendances de test FilAgent"
echo "================================================"
echo ""

# Couleurs pour output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# V√©rifier si pip est disponible
if ! command -v pip &> /dev/null; then
    echo -e "${RED}‚ùå pip n'est pas install√©${NC}"
    exit 1
fi

echo -e "${YELLOW}üì¶ Installation des d√©pendances de test...${NC}"
echo ""

# Core testing framework
echo "‚Üí pytest et plugins..."
pip install -q pytest pytest-cov pytest-asyncio pytest-mock

# FastAPI testing
echo "‚Üí FastAPI et d√©pendances..."
pip install -q fastapi uvicorn httpx

# Core dependencies
echo "‚Üí Core dependencies..."
pip install -q pyyaml pydantic structlog aiosqlite

# Cryptography
echo "‚Üí Cryptography..."
pip install -q cryptography cffi

# Optional but recommended
echo "‚Üí Optional dependencies..."
pip install -q pytest-xdist  # Parallel test execution

echo ""
echo -e "${GREEN}‚úÖ Toutes les d√©pendances sont install√©es${NC}"
echo ""

# V√©rifier l'installation
echo "V√©rification de l'installation..."
python -c "import pytest; print(f'  pytest {pytest.__version__}')"
python -c "import fastapi; print(f'  fastapi {fastapi.__version__}')"
python -c "import cryptography; print(f'  cryptography {cryptography.__version__}')"

echo ""
echo -e "${GREEN}‚úÖ Installation termin√©e avec succ√®s${NC}"
echo ""
echo "Pour ex√©cuter les tests:"
echo "  ./scripts/run_tests.sh"
echo "  ou: make test"
